<?xml version="1.0" encoding="UTF-8"?><record_update table="sp_widget">
    <sp_widget action="INSERT_OR_UPDATE">
        <category>custom</category>
        <client_script><![CDATA[api.controller = function($http, $location, spUtil, $scope) {
    var c = this;

    // Initialize data object
    c.data = {
        sys_id: $location.search().sys_id,
        bidAmount: ''
    };

    // Fetch event details
    var itemUrl = 'https://dev203498.service-now.com/api/now/table/x_1383184_charityb_events/' + c.data.sys_id;
    $http.get(itemUrl).then(function(response) {
    c.data.event_type = response.data.result.event_type;
    c.data.event_name = response.data.result.event_name; 
    c.data.description = response.data.result.description;
    c.data.start_date = response.data.result.start_date;
    c.data.end_date = response.data.result.end_date;
    c.data.justgiving_url = response.data.result.justgiving_url;
    // Add more fields as needed
}, function(error) {
    console.error('Failed to fetch event details:', error);
    c.errorMessage = 'Failed to fetch event details.';
});

	
	// Function to calculate minimum start date (today's date)
    c.minStartDate = function() {
        var today = new Date();
        var dd = today.getDate();
        var mm = today.getMonth() + 1; // January is 0!
        var yyyy = today.getFullYear();

        if (dd < 10) {
            dd = '0' + dd;
        }

        if (mm < 10) {
            mm = '0' + mm;
        }

        return yyyy + '-' + mm + '-' + dd;
    };


    // Function to submit/update the event
    c.createEvent = function() {
        var eventData = {
					  event_type: c.data.event_type,
            event_name: c.data.event_name,
            description: c.data.description,
            start_date: c.data.start_date,
            end_date: c.data.end_date,
            justgiving_url: c.data.justgiving_url
            // Add more fields as needed
        };

        if (c.data.sys_id) {
            // If sys_id exists, update the existing record
            $http.put('https://dev203498.service-now.com/api/now/table/x_1383184_charityb_events/' + c.data.sys_id, eventData).then(function(response) {
                if (response.data.result) {
                    c.successMessage = 'Event updated successfully!';
                } else {
                    c.errorMessage = 'Failed to update event.';
                }
            }, function(error) {
                console.error('Error during event update:', error);
                c.errorMessage = 'An error occurred during event update.';
            });
        } else {
            c.errorMessage = 'Missing sys_id to update event.';
        }
    };
};
]]></client_script>
        <controller_as>c</controller_as>
        <css>.countdown-timer {
    font-family: Arial, sans-serif;
    font-size: 2em;
    text-align: center;
    color: #333;
}
.time {
    background-color: #f0f0f0;
    padding: 10px;
    border-radius: 5px;
    display: inline-block;
}
h1, .h1 {
    font-size: 3.6rem;
    color: #428bca;
}

input#eventType,
input#eventName,
input#startDate,
input#endDate,
input#justgivingUrl,
textarea#description,
input#imageUpload {
    border-radius: 20px;
    border: 1px solid #337f9f;
    color: #000;  /* Font color set to black */
}

.modal-content {
    margin-bottom: 3rem;
}

.modal-header {
    height: 9rem;
    text-align: center;
}

img {
    width: 50%;
}
.imgC {
    display: flex;
    justify-content: center;
}

.col-md-6 {
    width: 50%;
}
.btn-primary {
    width: 123px;
    height: 40px;
    color: #fff;
    background-color: #36879f;
    border-color: #357ebd;
}
</css>
        <data_table>sp_instance</data_table>
        <demo_data/>
        <description/>
        <docs/>
        <field_list/>
        <has_preview>true</has_preview>
        <id>cb_justgiving_details</id>
        <internal>false</internal>
        <link><![CDATA[function link(scope, element, attrs, controller) {  }]]></link>
        <name>cb justgiving details</name>
        <option_schema/>
        <public>false</public>
        <roles/>
        <script><![CDATA[(function() {
    var eventSysId = $sp.getParameter('sys_id');
    var data = {};
	
	if (!eventSysId) {
        data.errorMessage = 'EventSysId parameter is missing';
        return data;
    }
	
    // Create a new GlideRecord object for the event
    var grEvent = new GlideRecord('x_1383184_charityb_events');
    grEvent.addQuery('sys_id', eventSysId);
    grEvent.query();
	
    if (grEvent.next()) {
        // Populate data object with event details
        data.sys_id = eventSysId;
        data.event_type = grEvent.getValue('event_type');
			data.event_name = grEvent.getValue('event_name');
        //data.description = grEvent.getValue('description');
        //data.start_date = grEvent.getValue('start_date'); // Add more fields as needed

        // Clear any previous error message
        data.errorMessage = '';
    } else {
        data.errorMessage = 'Event not found with sys_id: ' + eventSysId;
    }

    return data;
})();
]]></script>
        <servicenow>false</servicenow>
        <sys_class_name>sp_widget</sys_class_name>
        <sys_created_by>christy</sys_created_by>
        <sys_created_on>2024-07-18 04:52:51</sys_created_on>
        <sys_id>8ff39990932b421094e3f15a7bba105c</sys_id>
        <sys_mod_count>64</sys_mod_count>
        <sys_name>cb justgiving details</sys_name>
        <sys_package display_value="CharityBids" source="x_1383184_charityb">bcaeeadb9369421094e3f15a7bba1090</sys_package>
        <sys_policy/>
        <sys_scope display_value="CharityBids">bcaeeadb9369421094e3f15a7bba1090</sys_scope>
        <sys_update_name>sp_widget_8ff39990932b421094e3f15a7bba105c</sys_update_name>
        <sys_updated_by>lalitha</sys_updated_by>
        <sys_updated_on>2024-07-26 05:13:53</sys_updated_on>
        <template><![CDATA[<div class="item-details" ng-if="c.data">
    <div class="modal-content">
        <div class="modal-header">
            <h1>Event Creation Wizard</h1>
            <p class="quote" style="
                position: relative;
                bottom: 1rem;
                color: #000;  /* Font color set to black */
                width: 40rem;
                left: 64rem;
                box-shadow: rgba(50, 50, 93, 0.25) 0px 13px 27px -5px, rgba(0, 0, 0, 0.3) 0px 8px 16px -8px;
                font-size: 22px;
                background: #3c98a04a;
                padding: 10px;">"Fundraising is the gentle art of teaching the joy of giving." - Hank Rosso</p>
        </div>

        <div class="panel panel-default">
            <div class="panel-body">
                <form name="eventForm" ng-submit="c.submitEvent()">
                    <div class="modal-body">
                      
                        <!-- Input field for Event Type -->
                        <div class="form-group">
                            <label for="eventType">Event Type:</label>
                            <input type="text" value="{{c.data.event_type}}" class="form-control" id="eventType" placeholder="Enter event type" required>
                        </div>
                      
                        <!-- Input field for Event Name -->
                        <div class="form-group">
                            <label for="eventName">Event Name:</label>
                            <input type="text" class="form-control" id="eventName" placeholder="Enter event name" required>
                        </div>

                        <!-- Input field for Start Date -->
                        <div class="form-group">
                            <label for="startDate">Start Date:</label>
                            <input type="date" class="form-control" id="startDate" ng-model="c.data.start_date" min="{{ c.minStartDate() }}" required>
                        </div>

                        <!-- Input field for End Date -->
                        <div class="form-group">
                            <label for="endDate">End Date:</label>
                            <input type="date" class="form-control" id="endDate" ng-model="c.data.end_date" required>
                        </div>
                      
                        <!-- Input field for JustGiving URL -->
                        <div class="form-group">
                            <label for="justgivingUrl">Page URL:</label>
                            <input type="text" class="form-control" id="justgivingUrl" ng-model="c.data.justgiving_url" placeholder="Enter JustGiving URL">
                        </div>

                        <!-- Textarea for Description -->
                        <div class="form-group">
                            <label for="description">Description:</label>
                            <textarea class="form-control" id="description" ng-model="c.data.description" placeholder="Enter event description" rows="5" required></textarea>
                        </div>
                      
                        <!-- Upload Image -->
                        <div class="form-group">
                            <label for="imageUpload">Upload Image:</label>
                            <input type="file" id="imageUpload" accept="image/*" onchange="angular.element(this).scope().c.uploadImage(this.files)" required>
                            <p class="help-block">Select an image file (JPEG, PNG, etc.)</p>
                        </div>

                        <!-- Submit Button -->
                        <button type="submit" class="btn btn-primary" ng-click="c.createEvent()">Create Event</button>

                        <!-- Error and Success Messages -->
                        <p ng-if="c.errorMessage" class="text-danger">{{c.errorMessage}}</p>
                        <p ng-if="c.successMessage" class="text-success">{{c.successMessage}}</p>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
]]></template>
    </sp_widget>
</record_update>
