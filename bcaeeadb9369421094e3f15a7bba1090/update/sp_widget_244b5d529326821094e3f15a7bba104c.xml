<?xml version="1.0" encoding="UTF-8"?><record_update table="sp_widget">
    <sp_widget action="INSERT_OR_UPDATE">
        <category>custom</category>
        <client_script><![CDATA[api.controller = function($scope, $window, $interval) {
    var c = this;

    // Initialize data.items
    c.data.items = c.data.items || [];

    // Countdown timer function
    function updateCountdown(endDateTime) {
        var now = new Date();
        var endTime = new Date(endDateTime);

        var timeRemaining = endTime.getTime() - now.getTime();
        if (timeRemaining < 0) {
            // If end time has passed
            return {text: "Closed", colorClass: "red"};
        } else {
            var hours = Math.floor(timeRemaining / (1000 * 60 * 60));
            var minutes = Math.floor((timeRemaining % (1000 * 60 * 60)) / (1000 * 60));
            var seconds = Math.floor((timeRemaining % (1000 * 60)) / 1000);
            var countdownText = ("0" + hours).slice(-2) + ":" + ("0" + minutes).slice(-2) + ":" + ("0" + seconds).slice(-2);
            return {text: countdownText, colorClass: "green"};
        }
    }

    // Update countdown initially and every second
    $interval(function() {
        c.data.topItems.forEach(function(item) {
            var countdown = updateCountdown(item.end_date);
            item.countdown = countdown.text;
            item.countdownClass = countdown.colorClass;
        });
    }, 1000);

    // Function to show item details
    c.showDetails = function(item) {
        var itemDetailUrl = "?id=item_details&sys_id=" + item.sys_id;
        $window.location.href = itemDetailUrl; // Redirect to item details page
    };

    // Watch the items array for changes
    $scope.$watch(function() {
        return c.data.items;
    }, function(newVal, oldVal) {
        if (newVal && newVal.length === 0) {
            $scope.noItemsMessage = "No items available";
        } else {
            $scope.noItemsMessage = "";
        }
    }, true);
};
]]></client_script>
        <controller_as>c</controller_as>
        <css>.container {
    max-width: 960px;
    margin: 0 auto;
    padding: 20px;
}

.items-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); /* Responsive grid, minimum width 300px */
    gap: 20px;
}

.item-card {
    position: relative;
    height: 21vh;
    background-color: #fff;
    border: .1rem solid #e0e0e0;
    border-radius: .8rem;
    overflow: hidden;
    display: flex;
    transition: transform .3s ease;
    cursor: pointer;
}

.item-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
}

.item-image {
    min-width: 50%;
}

.item-image img {
    width: 24vh;
    height: 21vh;
    border-radius: .8rem .8rem 0 0;
    object-fit: cover;
}

.item-countdown {
    position: absolute;
    top: 1rem;
    right: 1rem;
    padding: .5rem 1rem;
    border-radius: .4rem;
    font-size: 1.4rem;
}

.item-countdown.green {
    background-color: rgba(0, 128, 0, .8); /* Green background */
    color: #fff;
}

.item-countdown.red {
    background-color: rgba(255, 0, 0, .8); /* Red background */
    color: #fff;
}

.item-details {
    padding: 15px;
}

.item-info {
    margin-bottom: 10px;
}

.item-name {
    font-size: 2.2rem;
    font-weight: bold;
}

.highest-bid {
    font-size: 1.9rem;
}</css>
        <data_table>sp_instance</data_table>
        <demo_data/>
        <description/>
        <docs/>
        <field_list>color</field_list>
        <has_preview>true</has_preview>
        <id>cb_item_list</id>
        <internal>false</internal>
        <link><![CDATA[function link($scope) {
    // Link function to handle additional setup
    $scope.placeBid = function(item) {
        alert('Placing bid for: ' + item.name);
        // Here you can add logic to open a bid modal, send a request, etc.
    };
}
]]></link>
        <name>cb_Item list</name>
        <option_schema>[{"name":"show_star_rating","default_value":"Use system properties","section":"Presentation","label":"Show star rating","type":"choice","choices":[{"label":"Yes","value":"Yes"},{"label":"No","value":"No"},{"label":"Use system properties","value":"Use system properties"}]},{"hint":"Number of articles to display per page","name":"limit_article","section":"other","default_value":"10","label":"Number of articles to display per page","type":"integer"}]</option_schema>
        <public>true</public>
        <roles/>
        <script><![CDATA[(function($sp, input, data, options, gs) {
    // Initialize data arrays
    data.topItems = [];

    // Fetch all items where end_date is today
    var itemGR = new GlideRecord('x_1383184_charityb_item');
    itemGR.addQuery('end_date', '>=', gs.beginningOfToday());
    itemGR.addQuery('end_date', '<=', gs.endOfToday());
    itemGR.query();

    while (itemGR.next()) {
        data.topItems.push({
            sys_id: itemGR.getUniqueValue(),
            item_name: itemGR.getValue('item_name'),
            highest_bid_amount: itemGR.getValue('highest_bid_amount'),
            image: itemGR.getDisplayValue('image'),
            end_date: itemGR.getDisplayValue('end_date') // Fetch the end date
        });
    }

    if (data.topItems.length === 0) {
        gs.addInfoMessage("No Items Available");
    }
})($sp, input, data, options, gs);
]]></script>
        <servicenow>false</servicenow>
        <sys_class_name>sp_widget</sys_class_name>
        <sys_created_by>lalitha</sys_created_by>
        <sys_created_on>2024-06-04 17:29:41</sys_created_on>
        <sys_id>244b5d529326821094e3f15a7bba104c</sys_id>
        <sys_mod_count>245</sys_mod_count>
        <sys_name>cb_Item list</sys_name>
        <sys_package display_value="CharityBids" source="x_1383184_charityb">bcaeeadb9369421094e3f15a7bba1090</sys_package>
        <sys_policy/>
        <sys_scope display_value="CharityBids">bcaeeadb9369421094e3f15a7bba1090</sys_scope>
        <sys_update_name>sp_widget_244b5d529326821094e3f15a7bba104c</sys_update_name>
        <sys_updated_by>lalitha</sys_updated_by>
        <sys_updated_on>2024-07-18 18:41:35</sys_updated_on>
        <template><![CDATA[<div class="container">
    <h1>${Trending Lots}</h1>
    <div class="items-grid">
        <!-- Display top items in a grid -->
        <div ng-repeat="item in c.data.topItems" ng-click="c.showDetails(item)" class="item-card">
            <div class="item-image">
                <img ng-src="{{item.image || 'https://dev203498.service-now.com/logo%20image.jpg'}}" alt="{{item.item_name}}">
                <div class="item-countdown" ng-class="item.countdownClass">{{item.countdown}}</div>
            </div>
            <div class="item-details">
                <div class="item-info">
                    <div class="item-name">{{item.item_name}}</div>
                    <div class="highest-bid">${Highest Bid}: ${{item.highest_bid_amount}}</div>
                </div>
            </div>
        </div>
    </div>
</div>
]]></template>
    </sp_widget>
</record_update>
