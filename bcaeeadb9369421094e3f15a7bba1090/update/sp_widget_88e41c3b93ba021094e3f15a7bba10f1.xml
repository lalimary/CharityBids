<?xml version="1.0" encoding="UTF-8"?><record_update table="sp_widget">
    <sp_widget action="INSERT_OR_UPDATE">
        <category>custom</category>
        <client_script><![CDATA[api.controller = function($scope) {
    var c = this;

    // Initialize data.items
    c.data.events = c.data.events || [];

    // Initialize search query
    $scope.searchQuery = '';

    // Function to open event details
    c.openEventDetails = function(sysId) {
        var eventDetailUrl = "?id=event_details&sys_id=" + sysId;
        window.open(eventDetailUrl, '_blank');
    };

    // Watch the items array for changes
    $scope.$watch(function() {
        return c.data.events;
    }, function(newVal, oldVal) {
        if (newVal && newVal.length === 0) {
            $scope.noEventsMessage = "No events available";
        } else {
            $scope.noEventsMessage = "";
        }
        // Update filtered events based on search query
        updateFilteredEvents();
    }, true);

    // Watch the searchQuery for changes and filter events accordingly
    $scope.$watch('searchQuery', function(newVal, oldVal) {
        if (newVal !== oldVal) {
            updateFilteredEvents();
        }
    });

    // Function to filter events based on search query
    function updateFilteredEvents() {
        if (!$scope.searchQuery) {
            $scope.filteredEvents = c.data.events;
        } else {
            $scope.filteredEvents = c.data.events.filter(function(event) {
                // Match event name and description against search query
                return event.event_name.toLowerCase().includes($scope.searchQuery.toLowerCase()) ||
                       event.description.toLowerCase().includes($scope.searchQuery.toLowerCase());
            });
        }
    }

    // Display filtered events initially
    $scope.filteredEvents = c.data.events;

};
]]></client_script>
        <controller_as>c</controller_as>
        <css>body {
  font-family: 'Calibri', sans-serif;
  font-size: 16px;
  background-color: #f4f4f4;
  margin: 0;
  padding: 0;
  text-align: center;
}

.event-details {
  max-width: 800px;
  margin: 20px auto;
  background: #fff;
  padding: 20px;
  border-radius: 8px;
  box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
  text-align: left;
}

.event-header h2 {
  font-size: 2.5rem;
  margin-bottom: 20px;
  text-align: center;
  background-image: radial-gradient(circle, #29b3ff, #31789f);
  color: transparent;
  background-clip: text;
  -webkit-background-clip: text;
}

.event-content {
  display: flex;
  flex-wrap: wrap;
  gap: 20px;
}

.event-image img {
  width: 100%;
  height: auto;
  border-radius: 8px;
  object-fit: cover;
}

.event-info {
  flex: 1;
  font-size: 18px;
  line-height: 1.6;
}

.event-info p {
  margin: 10px 0;
}

.event-info strong {
  font-weight: 600;
}

.event-info a {
  color: #31789f;
  text-decoration: none;
}

.event-info a:hover {
  text-decoration: underline;
}

.status {
  padding: 4px 8px;
  border-radius: 4px;
  color: #fff;
}

.status.in-progress {
  background-color: #29b3ff;
}

.status.schedule {
  background-color: #ffba29;
}

.status.completed {
  background-color: #4caf50;
}

.event-actions {
  margin-top: 20px;
}

.event-actions .btn {
  padding: 10px 20px;
  font-size: 16px;
  border: none;
  border-radius: 4px;
  cursor: pointer;
  transition: background-color 0.3s;
}

.event-actions .btn-primary {
  background-color: #31789f;
  color: #fff;
}

.event-actions .btn-primary:hover {
  background-color: #255b7b;
}

.fundraising-stats {
  text-align: right;
}

.fundraising-stats p {
  margin: 0;
}

.fundraising-stats .amount {
  font-size: 41pt;
}

.fundraising-stats .raised {
  font-size: 13pt;
}

.fundraising-stats .supporters {
  font-size: 13pt;
}
</css>
        <data_table>sp_instance</data_table>
        <demo_data/>
        <description/>
        <docs/>
        <field_list/>
        <has_preview>true</has_preview>
        <id>test</id>
        <internal>false</internal>
        <link><![CDATA[function link(scope, element, attrs, controller) {  }]]></link>
        <name>test</name>
        <option_schema/>
        <public>false</public>
        <roles/>
        <script><![CDATA[(function($sp, input, data, options, gs) {
    data.events = [];
    
    var eventGR = new GlideRecord('x_1383184_charityb_events');
    eventGR.addQuery('event_status', 'IN', ['in progress', 'schedule', 'completed']);
    eventGR.query();

    while (eventGR.next()) {
        var event_managerName = '';
        if (eventGR.event_manager) {
            var userGR = new GlideRecord('x_1383184_charityb_user_profile');
            if (userGR.get(eventGR.event_manager)) {
                event_managerName = userGR.getValue('name');
            }
        }

        data.events.push({
            sys_id: eventGR.getUniqueValue(),
            event_name: eventGR.getValue('event_name'),
            description: eventGR.getValue('description'),
            start_date: eventGR.getValue('start_date'),
            end_date: eventGR.getValue('end_date'),
            charity_company: eventGR.getValue('charity_company'),
            status: eventGR.getValue('event_status'),
            image: eventGR.getDisplayValue('image'),
            justgiving_url: eventGR.getValue('justgiving_url')
        });
    }

    if (data.events.length === 0) {
        gs.addInfoMessage("No Events Available");
    }
})($sp, input, data, options, gs);
]]></script>
        <servicenow>false</servicenow>
        <sys_class_name>sp_widget</sys_class_name>
        <sys_created_by>lalitha</sys_created_by>
        <sys_created_on>2024-06-21 14:28:46</sys_created_on>
        <sys_id>88e41c3b93ba021094e3f15a7bba10f1</sys_id>
        <sys_mod_count>128</sys_mod_count>
        <sys_name>test</sys_name>
        <sys_package display_value="CharityBids" source="x_1383184_charityb">bcaeeadb9369421094e3f15a7bba1090</sys_package>
        <sys_policy/>
        <sys_scope display_value="CharityBids">bcaeeadb9369421094e3f15a7bba1090</sys_scope>
        <sys_update_name>sp_widget_88e41c3b93ba021094e3f15a7bba10f1</sys_update_name>
        <sys_updated_by>lalitha</sys_updated_by>
        <sys_updated_on>2024-07-01 10:55:43</sys_updated_on>
        <template><![CDATA[<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Event Details</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>

<div class="event-details">
  <div class="event-header">
    <h2>Charity Event</h2>
  </div>
  <div class="event-content">
    <div class="event-image">
      <img src="https://dev203498.service-now.com/x_1383184_charityb.item%20default%20image.jpg" alt="Charity Event">
    </div>
    <div class="event-info">
      <p>Description of the event goes here. It provides an overview of what the event is about, its purpose, and key details.</p>
      <p><strong>Start Date:</strong> 01/07/2024</p>
      <p><strong>End Date:</strong> 31/07/2024</p>
      <p><strong>Donation URL:</strong> <a href="#" target="_blank">https://justgiving.com</a></p>
      <p><strong>Status:</strong> <span class="status in-progress">In Progress</span></p>
      <div class="event-actions">
        <button class="btn btn-primary">Donate Money</button>
        <a href="?id=list_of_items" target="_blank" class="btn btn-primary">Participate in Auction</a>
        <a href="?id=upload_item&event_name=Charity Event" target="_blank" class="btn btn-primary">Donate Items</a>
      </div>
    </div>
  </div>
  <div class="fundraising-stats">
    <p class="amount">£6,104,888</p>
    <p class="raised">raised of £6,800,000 target</p>
    <p class="supporters">by 29646 supporters</p>
  </div>
</div>

</body>
</html>
]]></template>
    </sp_widget>
</record_update>
