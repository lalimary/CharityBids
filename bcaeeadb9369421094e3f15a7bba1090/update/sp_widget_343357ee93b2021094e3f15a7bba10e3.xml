<?xml version="1.0" encoding="UTF-8"?><record_update table="sp_widget">
    <sp_widget action="INSERT_OR_UPDATE">
        <category>custom</category>
        <client_script><![CDATA[api.controller = function($rootScope, $location, $scope) {
    var c = this;

    c.showDetails = function(item) {
        var params = {
            sys_id: item.sys_id,
            item_name: item.item_name,
            start_bid_amount: item.start_bid_amount,
            highest_bid_amount: item.highest_bid_amount
        };

        // Broadcast event to update cb_bid_form
        $rootScope.$broadcast('sp.update', {
            widget: {
                id: 'cb_bid_2'
            },
            params: params
        });
    };

    c.isToday = function(endDate) {
        var today = new Date().toISOString().split('T')[0];
        return endDate.split(' ')[0] === today;
    };

    $scope.initializeCountdown = function() {
        var now = new Date();
        var midnight = new Date();
        midnight.setHours(24, 0, 0, 0); // Set time to midnight

        var countdownFunction = setInterval(function() {
            var now = new Date().getTime();
            var distance = midnight.getTime() - now;

            var hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
            var minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
            var seconds = Math.floor((distance % (1000 * 60)) / 1000);

            document.getElementById("countdown").innerHTML = hours + "h " +
                minutes + "m " + seconds + "s ";

            if (distance < 0) {
                clearInterval(countdownFunction);
                document.getElementById("countdown").innerHTML = "EXPIRED";
            }
        }, 1000);
    };

    if (c.isToday(c.data.end_date)) {
        $scope.initializeCountdown();
    }
};
]]></client_script>
        <controller_as>c</controller_as>
        <css>.countdown-timer {
  font-family: Arial, sans-serif;
  font-size: 2em;
  text-align: center;
  color: #333;
}
.time {
  background-color: #f0f0f0;
  padding: 10px;
  border-radius: 5px;
  display: inline-block;
}
img {
  width: 50%;
}
.imgC {
  display: flex;
  justify-content: center;
}</css>
        <data_table>sp_instance</data_table>
        <demo_data/>
        <description/>
        <docs/>
        <field_list/>
        <has_preview>true</has_preview>
        <id>cb_item_details</id>
        <internal>false</internal>
        <link><![CDATA[function link(scope, element, attrs, controller) {  }]]></link>
        <name>cb item details</name>
        <option_schema/>
        <public>false</public>
        <roles/>
        <script><![CDATA[(function() {
    var ItemSysId = $sp.getParameter('sys_id');
    var gr = new GlideRecord('x_1383184_charityb_item');
    gr.addQuery('sys_id', ItemSysId);
    gr.query();

    while (gr.next()) {
        data.item_name = gr.getValue('item_name');
        data.start_date = gr.getValue('start_date');
        data.end_date = gr.getValue('end_date');
        data.value = gr.getValue('value');
        data.start_bid_amount = gr.getValue('start_bid_amount');
        data.highest_bid_amount = gr.getValue('highest_bid_amount');
        data.auction_status = gr.getDisplayValue('auction_status');
        data.image = gr.getDisplayValue('image');
        data.description = gr.getValue('description');
    }
})();
]]></script>
        <servicenow>false</servicenow>
        <sys_class_name>sp_widget</sys_class_name>
        <sys_created_by>christy</sys_created_by>
        <sys_created_on>2024-06-18 07:07:54</sys_created_on>
        <sys_id>343357ee93b2021094e3f15a7bba10e3</sys_id>
        <sys_mod_count>87</sys_mod_count>
        <sys_name>cb item details</sys_name>
        <sys_package display_value="CharityBids" source="x_1383184_charityb">bcaeeadb9369421094e3f15a7bba1090</sys_package>
        <sys_policy/>
        <sys_scope display_value="CharityBids">bcaeeadb9369421094e3f15a7bba1090</sys_scope>
        <sys_update_name>sp_widget_343357ee93b2021094e3f15a7bba10e3</sys_update_name>
        <sys_updated_by>lalitha</sys_updated_by>
        <sys_updated_on>2024-07-09 19:00:43</sys_updated_on>
        <template><![CDATA[<h1>Embrace Exclusivity: {{c.data.item_name}} Awaits You!</h1>
<div class="item-details" ng-if="c.data">
  <div class="modal-content">
    <div class="modal-header">
      <h4 class="modal-name">{{c.data.item_name}}</h4>
    </div>
    <div class="imgC">
      <img ng-src="{{c.data.image || 'https://dev203498.service-now.com/x_1383184_charityb.item%20default%20image.jpg'}}" alt="{{c.data.item_name}}">
    </div>
    <div class="modal-body">
      <p><strong>Description:</strong> {{c.data.description}}</p>
      <p><strong>Auction Start Date:</strong> {{c.data.start_date}}</p>
      <p><strong>Auction End Date:</strong> {{c.data.end_date}}</p>
      <p><strong>Value:</strong> {{c.data.value}}</p>
      <p><strong>Status:</strong> {{c.data.auction_status}}</p>
      <!--<button class="btn btn-primary" ng-click="c.showDetails(c.data)">Place Bid</button>-->
    </div>
    <div ng-if="c.isToday(c.data.end_date)">
      <div class="countdown-timer">
        <div class="time" id="countdown"></div>
      </div>
    </div>
  </div>
</div>


]]></template>
    </sp_widget>
</record_update>
