<?xml version="1.0" encoding="UTF-8"?><record_update table="sp_widget">
    <sp_widget action="INSERT_OR_UPDATE">
        <category>custom</category>
        <client_script><![CDATA[api.controller = function($scope, spUtil) {
    var c = this;

    // Initialize data.items
    c.data.items = c.data.items || [];

    // Function to show item details
    c.showDetails = function(item) {
        c.selectedItem = item;
    };

    // Watch the items array for changes
    $scope.$watch(function() {
        return c.data.items;
    }, function(newVal) {
        if (newVal && newVal.length === 0) {
            $scope.noItemsMessage = "No items available";
        } else {
            $scope.noItemsMessage = "";
        }
    }, true);

    // Initial data fetch
    spUtil.get('cb_my_donations').then(function(response) {
        c.data.items = response.data.items;
        console.log('Items fetched successfully:', response);
    }).catch(function(error) {
        console.error('Error fetching items:', error);
    });
};
]]></client_script>
        <controller_as>c</controller_as>
        <css>/* Container and layout */
.container {
    padding: 20px;
    max-width: 1000px; /* Adjusted to be a bit narrower */
    margin: auto;
}

h1 {
    text-align: center;
    margin-bottom: 20px;
}

.search-input {
    width: 100%;
    padding: 10px;
    margin-bottom: 20px;
    border: 1px solid #ccc;
    border-radius: 5px;
    font-size: 16px;
}

/* Grid layout for items */
#items-grid {
    display: flex;
    flex-wrap: wrap;
    gap: 15px; /* Reduced gap */
}

.event-card {
    flex: 1 1 calc(25% - 15px); /* Reduced width of each card */
    background: #fff;
    border: 1px solid #ddd;
    border-radius: 8px;
    overflow: hidden;
    box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    transition: transform 0.3s, box-shadow 0.3s;
    max-width: 300px; /* Set a maximum width for the card */
    min-height: 200px; /* Set a minimum height */
}

.event-card:hover {
    transform: scale(1.02);
    box-shadow: 0 4px 10px rgba(0,0,0,0.2);
}

.event-card-link {
    text-decoration: none;
    color: inherit;
    display: block;
    height: 100%;
}

.event-image {
    width: 100%;
    height: 150px; /* Reduced height of the image */
    background-size: cover;
    background-position: center;
}

.event-content {
    padding: 10px; /* Reduced padding */
}

.event-title {
    font-size: 16px; /* Reduced font size */
    font-weight: bold;
    margin-bottom: 5px; /* Reduced margin */
}

.event-status {
    display: flex;
    align-items: center;
    font-size: 14px; /* Reduced font size */
}

.event-status-icon {
    margin-right: 5px; /* Reduced margin */
    font-size: 20px; /* Reduced icon size */
}

.event-status-text {
    font-size: 14px; /* Reduced font size */
}

/* Status colors */
.item-submitted {
    color: #eb952d; /* Orange color */
}

.auction-scheduled {
    color: #0cabd9; /* Blue color */
}

.auction-in-progress {
    color: #0da636; /* Green color */
}

.auction-completed {
    color: #ff0000; /* Red color */
}
</css>
        <data_table>sp_instance</data_table>
        <demo_data/>
        <description/>
        <docs/>
        <field_list>color</field_list>
        <has_preview>true</has_preview>
        <id>cb_my_donations</id>
        <internal>false</internal>
        <link><![CDATA[function link($scope) {
    // Link function to handle additional setup
    $scope.placeBid = function(item) {
        alert('Placing bid for: ' + item.name);
        // Here you can add logic to open a bid modal, send a request, etc.
    };
}
]]></link>
        <name>cb my donations</name>
        <option_schema>[{"name":"show_star_rating","default_value":"Use system properties","section":"Presentation","label":"Show star rating","type":"choice","choices":[{"label":"Yes","value":"Yes"},{"label":"No","value":"No"},{"label":"Use system properties","value":"Use system properties"}]},{"hint":"Number of articles to display per page","name":"limit_article","section":"other","default_value":"10","label":"Number of articles to display per page","type":"integer"}]</option_schema>
        <public>true</public>
        <roles/>
        <script><![CDATA[(function($sp, input, data, options, gs) {
    data.items = [];
    var userID = gs.getUserID();
    var userProfileID = '';

    // Status mapping with colors
    var statusMapping = {
        'item_submitted': { text: 'Item Submitted', color: '#4CAF50' }, // Green
        'auction_scheduled': { text: 'Auction Scheduled', color: '#FFC107' }, // Amber
        'auction_in_progress': { text: 'Auction In Progress', color: '#2196F3' }, // Blue
        'auction_completed': { text: 'Auction Completed', color: '#F44336' } // Red
    };

    // Fetch the user profile record associated with the logged-in user
    var userProfileGR = new GlideRecord('x_1383184_charityb_user_profile');
    userProfileGR.addQuery('name', userID);
    userProfileGR.query();
    if (userProfileGR.next()) {
        userProfileID = userProfileGR.getUniqueValue();
    } else {
        gs.info('No user profile found for user: ' + userID);
        data.noItemsMessage = "No Items Available";
        return;
    }

    // Fetch all items based on user profile
    var itemGR = new GlideRecord('x_1383184_charityb_item');
    itemGR.addQuery('donator', userProfileID);
    itemGR.query();

    while (itemGR.next()) {
        var donatorName = '';
        if (itemGR.donator) {
            var userGR = new GlideRecord('x_1383184_charityb_user_profile');
            if (userGR.get(itemGR.donator)) {
                donatorName = userGR.getValue('name');
            }
        }

        var status = itemGR.getValue('auction_status');
        var statusDetails = statusMapping[status] || { text: status, color: '#000000' }; // Default to black if not mapped

        data.items.push({
            sys_id: itemGR.getUniqueValue(),
            item_name: itemGR.getValue('item_name'),
            category: itemGR.getValue('category'),
            donator: donatorName,
            start_date: itemGR.getValue('start_date'),
            end_date: itemGR.getValue('end_date'),
            value: itemGR.getValue('value'),
            start_bid_amount: itemGR.getValue('start_bid_amount'),
            highest_bid_amount: itemGR.getValue('highest_bid_amount'),
            auction_status: statusDetails.text,
            status_color: statusDetails.color, // Added color
            image: itemGR.getDisplayValue('image'),
            description: itemGR.getValue('description')
        });
    }

    // Check if no items are found
    if (data.items.length === 0) {
        gs.info('No items found for user profile: ' + userProfileID);
        data.noItemsMessage = "No Items Available";
    } else {
        data.noItemsMessage = "";
    }

})($sp, input, data, options, gs);
]]></script>
        <servicenow>false</servicenow>
        <sys_class_name>sp_widget</sys_class_name>
        <sys_created_by>christy</sys_created_by>
        <sys_created_on>2024-06-18 07:15:17</sys_created_on>
        <sys_id>30e49f6293f2021094e3f15a7bba104a</sys_id>
        <sys_mod_count>42</sys_mod_count>
        <sys_name>cb my donations</sys_name>
        <sys_package display_value="CharityBids" source="x_1383184_charityb">bcaeeadb9369421094e3f15a7bba1090</sys_package>
        <sys_policy/>
        <sys_scope display_value="CharityBids">bcaeeadb9369421094e3f15a7bba1090</sys_scope>
        <sys_update_name>sp_widget_30e49f6293f2021094e3f15a7bba104a</sys_update_name>
        <sys_updated_by>lalitha</sys_updated_by>
        <sys_updated_on>2024-07-24 16:08:00</sys_updated_on>
        <template><![CDATA[<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>My Donations</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
<link rel="stylesheet" href="styles.css">
</head>
<body>
<div class="container">
<h1>My Donations</h1>
<input type="text" ng-model="searchQuery" placeholder="Search items..." class="search-input">
<div id="items-grid" class="events-grid">
<div ng-repeat="item in c.data.items | filter:searchQuery" class="event-card">
<a ng-href="?id=item_details&sys_id={{item.sys_id}}" class="event-card-link">
<div class="event-image" ng-style="{'background-image': 'url(' + (item.image || 'https://dev203498.service-now.com/logo%20image.jpg') + ')'}"></div>
<div class="event-content">
<div class="event-title">{{item.item_name}}</div>
<div class="event-status">
<div class="event-status-icon {{item.auction_status === 'Item Submitted' ? 'item-submitted' : item.auction_status === 'Auction Scheduled' ? 'auction-scheduled' : item.auction_status === 'Auction In Progress' ? 'auction-in-progress' : 'auction-completed'}}">
<span class="material-symbols-outlined">{{item.auction_status === 'Item Submitted' ? 'pending' : item.auction_status === 'Auction Scheduled' ? 'schedule' : item.auction_status === 'Auction In Progress' ? 'hourglass_bottom' : 'check_circle'}}</span>
</div>
<div class="event-status-text">{{item.auction_status}}</div>
</div>
</div>
</a>
</div>
</div>
</div>
</body>
</html>
]]></template>
    </sp_widget>
</record_update>
