<?xml version="1.0" encoding="UTF-8"?><record_update table="sp_widget">
    <sp_widget action="INSERT_OR_UPDATE">
        <category>custom</category>
        <client_script><![CDATA[api.controller = function($rootScope, $location, $scope, $window, $interval) {
    var c = this;

    // Initialize data.items
    c.data.items = c.data.items || [];

    // Countdown timer function
    function updateCountdown(endDateTime) {
        var now = new Date();
        var endTime = new Date(endDateTime);

        var timeRemaining = endTime.getTime() - now.getTime();
        if (timeRemaining < 0) {
            // If end time has passed
            return {text: "Closed", colorClass: "red"};
        } else {
            var hours = Math.floor(timeRemaining / (1000 * 60 * 60));
            var minutes = Math.floor((timeRemaining % (1000 * 60 * 60)) / (1000 * 60));
            var seconds = Math.floor((timeRemaining % (1000 * 60)) / 1000);
            var countdownText = ("0" + hours).slice(-2) + ":" + ("0" + minutes).slice(-2) + ":" + ("0" + seconds).slice(-2);
            return {text: countdownText, colorClass: "green"};
        }
    }

    // Update countdown initially and every second
    $interval(function() {
        c.data.items.forEach(function(item) {
            var countdown = updateCountdown(item.end_date);
            item.countdown = countdown.text;
            item.countdownClass = countdown.colorClass;
        });
    }, 1000);

    // Function to show item details
    c.showDetails = function(item) {
        var itemDetailUrl = "?id=item_details&sys_id=" + item.sys_id;
        $window.location.href = itemDetailUrl; // Redirect to item details page
    };

    // Watch the items array for changes
    $scope.$watch(function() {
        return c.data.items;
    }, function(newVal, oldVal) {
        if (newVal && newVal.length === 0) {
            $scope.noItemsMessage = "No items available";
        } else {
            $scope.noItemsMessage = "";
        }
    }, true);

    // Additional functions from the second script

    c.isToday = function(endDate) {
        var today = new Date().toISOString().split('T')[0];
        return endDate.split(' ')[0] === today;
    };

    $scope.initializeCountdown = function() {
        var now = new Date();
        var midnight = new Date();
        midnight.setHours(24, 0, 0, 0); // Set time to midnight

        var countdownFunction = setInterval(function() {
            var now = new Date().getTime();
            var distance = midnight.getTime() - now;

            var hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
            var minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
            var seconds = Math.floor((distance % (1000 * 60)) / 1000);

            document.getElementById("countdown").innerHTML = hours + "h " +
                minutes + "m " + seconds + "s ";

            if (distance < 0) {
                clearInterval(countdownFunction);
                document.getElementById("countdown").innerHTML = "EXPIRED";
            }
        }, 1000);
    };

    c.formatDate = function(dateString) {
        var options = { year: 'numeric', month: 'long', day: 'numeric' };
        var date = new Date(dateString);
        return date.toLocaleDateString(undefined, options);
    };

    // Initialize countdown if today is the end date
    if (c.isToday(c.data.end_date)) {
        $scope.initializeCountdown();
    }
};
]]></client_script>
        <controller_as>c</controller_as>
        <css>.item-details {
    display: flex;
    margin-top: 4rem;
    height: 57.6vh;
    align-items: flex-start;
}

.countdown-timer {
  display: inline-block;
  vertical-align: top;
  padding: 1rem;
  display: flex;
  border-radius: .8rem;
  background-color: #FFFFFF;
  border: .4rem solid #FFD700;
  box-shadow: 0 .2rem .4rem rgba(0, 0, 0, .1);
  align-items: center;
  height: 45px;
  margin-top: 15px;
}

.modal-header .header-title {
    font-size: 3.4rem;
    font-weight: 600;
    width: 85%;
    margin-left: 2rem;
    margin-top: 0rem;
    margin-bottom: 1rem;
    color: #000000;
}

.value2 {
    font-size: 16px;
    color: #000;
    border: 2px solid #327d9e;
    width: 86%;
    padding: 1rem 1rem;
    border-radius: 20px;
    /* box-shadow: rgba(0, 0, 0, 0.15) 0px 5px 15px 0px; */
}

h3.desc {
    width: 18%;
    position: relative;
    background: #fff;
    font-size: 2rem;
    color: #327d9e;
    left: 3%;
    display: flex;
    justify-content: center;
    top: 21px;
}

.modal-header {
    padding: 1rem 0rem;
    width: 100%;
    border-bottom: none;
    border-bottom: none;
    display: flex;
    align-items: baseline;
}

p.desc2.ng-binding {
    margin-top: 1rem;
}

.img-container {
    text-align: center;
    margin-right: 3rem;
    display: flex;
    height: 126%;
    width: 100%;
    overflow: hidden;
    margin-bottom: 2rem;
    justify-content: center;
    align-items: center;
}

.img-container img {
  width: 100%;
  border-radius: 20px;
  object-fit: cover;
}

.modal-content {
  border: none;
  height: 75%;
  box-shadow: none;
  display: flex;
  flex-direction: column;
  justify-content: flex-start;
}
.center1 {
  display: flex;
  flex-direction: row;
}

.info-container {
    display: flex;
    width: 100%;
    align-items: center;
    padding: 1rem 3rem;
    border-radius: .8rem;
    margin-bottom: 2rem;
    justify-content: flex-start;
}

.info-box {
  display: flex;
  flex-direction: column;
  align-items: center;
  padding: 1rem;
  background-color: #FFFFFF;
  border-radius: .8rem;
  min-width: 11rem;
  margin: 0 1rem;
  box-shadow: rgba(99, 99, 99, 0.2) 0px 2px 8px 0px;
}

.info-box .label {
  font-weight: bold;
  margin-bottom: .5rem;
  font-size: 1.6rem;
  color: #327e9f;
}

.info-box .value {
  color: #000000; /* Updated text color */
}

.modal-body .details-container {
    display: flex;
    margin-bottom: 2rem;
    flex-direction: column;
    flex-wrap: wrap;
    position: relative;
    top: -3rem;
}

.detail {
  /* flex: 1; */
  display: flex;
  min-width: 20rem;
  align-items: baseline;
}

.label {
  font-weight: bold;
  color: #000000; /* Updated text color */
}

.date-box {
  background-color: #FFD700;
  color: #000000;
  padding: 5px;
  border-radius: 4px;
  display: inline-block;
}

.bid-section {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-top: 20px;
}

.bid-info {
  display: flex;
  flex-direction: column;
}

.bid-start,
.bid-current {
  margin-bottom: 5px;
  color: #000000; /* Updated text color */
}

.labelDonator {
  color: #000;
  font-size: 18px;
  margin-right: 6px;
  font-weight: bold;
}

.value p {
  font-size: 17px;
  color: #000;
}

.btn-bid {
  background-color: #FFD700;
  color: #000000;
  padding: 10px 20px;
  border: none;
  border-radius: 4px;
  cursor: pointer;
}

.btn-bid:hover {
  background-color: #FFC700;
}

.countdown-timer .time {
  font-size: 20px;
  font-weight: bold;
  color: #FFD700;
}

.raise-issue-icon {
  // position: absolute;
  top: 10px; /* Adjust top position as needed */
  right: 10px; /* Adjust right position as needed */
  color: orange; /* Change color as desired */
  font-size: 24px; /* Adjust font size as needed */
}

.modal-content {
  /* Styles for modal content */
}

/* Additional styles for other elements if needed */

</css>
        <data_table>sp_instance</data_table>
        <demo_data/>
        <description/>
        <docs/>
        <field_list/>
        <has_preview>false</has_preview>
        <id>cb_item_details__test_</id>
        <internal>false</internal>
        <link><![CDATA[function link(scope, element, attrs, controller) {  }]]></link>
        <name>cb item details (test)</name>
        <option_schema/>
        <public>false</public>
        <roles/>
        <script><![CDATA[(function() {
    var itemSysId = $sp.getParameter('sys_id');
    var gr = new GlideRecord('x_1383184_charityb_item');
    if (gr.get(itemSysId)) {
        data.item_name = gr.getValue('item_name');
        data.description = gr.getValue('description');
        data.start_date = gr.getValue('start_date');
        data.end_date = gr.getValue('end_date');
        data.value = gr.getValue('value');
        data.auction_status = gr.getValue('auction_status');
        data.start_bid_amount = gr.getValue('start_bid_amount');
        data.highest_bid_amount = gr.getValue('highest_bid_amount');
		  	data.itemsys_id=gr.getUniqueValue();
        data.image = gr.getDisplayValue('image');
        data.category = gr.getDisplayValue('category');
        var donatorId = gr.getValue('donator');
        var donatorGr = new GlideRecord('x_1383184_charityb_user_profile');
        if (donatorGr.get(donatorId)) {
            data.donator = donatorGr.getDisplayValue('name');
            data.donator_location = donatorGr.getDisplayValue('location');
        }
    }
})();
]]></script>
        <servicenow>false</servicenow>
        <sys_class_name>sp_widget</sys_class_name>
        <sys_created_by>lalitha</sys_created_by>
        <sys_created_on>2024-07-24 14:49:34</sys_created_on>
        <sys_id>2a16161683e34610304f5c65eeaad37c</sys_id>
        <sys_mod_count>51</sys_mod_count>
        <sys_name>cb item details (test)</sys_name>
        <sys_package display_value="CharityBids" source="x_1383184_charityb">bcaeeadb9369421094e3f15a7bba1090</sys_package>
        <sys_policy/>
        <sys_scope display_value="CharityBids">bcaeeadb9369421094e3f15a7bba1090</sys_scope>
        <sys_update_name>sp_widget_2a16161683e34610304f5c65eeaad37c</sys_update_name>
        <sys_updated_by>christy</sys_updated_by>
        <sys_updated_on>2024-07-25 05:26:32</sys_updated_on>
        <template><![CDATA[<!DOCTYPE html>
<html ng-app="charityApp">

  <head>
    <title>Charity Bids Event Details</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
  </head>
  <body>

<div class="item-details" ng-if="c.data">


  <div class="img-container">
    <img ng-src="{{c.data.image || 'https://dev203498.service-now.com/x_1383184_charityb.item%20default%20image.jpg'}}" alt="{{c.data.item_name}}">
  </div>  
  <div class="modal-content">
    <div class="modal-header">
      <a href="?id=issue_form&sys_id={{c.data.itemsys_id}}" class="raise-issue-icon">
        <i class="fas fa-solid fa-exclamation-triangle"></i>
      </a>

      <h1 class="header-title">Embrace Exclusivity: {{c.data.item_name}} Awaits You!</h1>

    </div>

    <div class="info-container">
      <div class="center1">
        <div class="info-box">
          <div class="label">Location</div>
          <div class="value">{{c.data.donator_location}}</div>
        </div>
        <div class="info-box">
          <div class="label">Category</div>
          <div class="value">{{c.data.category}}</div>
        </div>
        <div class="info-box">
          <div class="label">Current Bid</div>
          <div class="value">$ {{c.data.highest_bid_amount}}</div>
        </div>
        <div class="info-box">
          <div class="label">End Date</div>
          <div class="value">{{c.formatDate(c.data.end_date)}}</div>
        </div>
      </div>
    </div>
    <div class="modal-body">
      <div class="details-container">
        <h3 class="desc">Description</h3>
        <div class="detail">
          <div class="value2">
            <p class="desc2">{{c.data.description}}</p>
          </div>
        </div>
      </div>
    </div>

  </div>


</div>
  </body>
</html>
]]></template>
    </sp_widget>
</record_update>
